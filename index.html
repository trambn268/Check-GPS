<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Điểm danh sinh viên DNT</title>
</head>
<body>
  <h2>Điểm danh sinh viên DNT</h2>
  <form id="attendanceForm">
    <label>Họ và tên:</label><br />
    <input type="text" id="name" required /><br /><br />

    <label>Lớp:</label><br />
    <input type="text" id="class" required /><br /><br />

    <label>Mã số sinh viên:</label><br />
    <input type="text" id="mssv" required /><br /><br />

    <label>Ngày học:</label><br />
    <input type="date" id="date" required /><br /><br />

    <label>Tiết học:</label><br />
    <select id="period" required>
      <option value="">--Chọn tiết học--</option>
      <option value="1-3">1-3</option>
      <option value="4-6">4-6</option>
      <option value="7-9">7-9</option>
      <option value="10-12">10-12</option>
    </select><br /><br />

    <label>Môn học:</label><br />
    <select id="subject" required>
      <option value="">--Chọn môn học--</option>
      <option value="An toàn sinh học">An toàn sinh học</option>
      <option value="Kiểm soát nhiễm khuẩn">Kiểm soát nhiễm khuẩn</option>
    </select><br /><br />

    <button type="submit">Gửi điểm danh</button>
  </form>

<script>
document.getElementById("attendanceForm").addEventListener("submit", function(e) {
  e.preventDefault();

  navigator.geolocation.getCurrentPosition(function(pos) {
    var lat = pos.coords.latitude;
    var lon = pos.coords.longitude;

    var formURL = "https://docs.google.com/forms/d/e/1FAIpQLSfcq5NlcENT1g1aVkTT9t0aQj-phEtT1VfgFR6xKQdg4t1-ng/formResponse";

    var entryName = "entry.1862566201";    // Họ và tên
    var entryClass = "entry.1185691424";   // Lớp
    var entryMSSV = "entry.1268168706";    // MSSV
    var entryDate = "entry.563044987";      // Ngày học
    var entryPeriod = "entry.1310161689";   // Tiết học
    var entrySubject = "entry.722540134";   // Môn học
    var entryGPS = "entry.994526785";       // Vị trí GPS

    var formData = new FormData();
    formData.append(entryName, document.getElementById("name").value);
    formData.append(entryClass, document.getElementById("class").value);
    formData.append(entryMSSV, document.getElementById("mssv").value);
    formData.append(entryDate, document.getElementById("date").value);
    formData.append(entryPeriod, document.getElementById("period").value);
    formData.append(entrySubject, document.getElementById("subject").value);
    formData.append(entryGPS, lat + "," + lon);

    fetch(formURL, {
      method: "POST",
      mode: "no-cors",
      body: formData
    }).then(() => {
      document.body.innerHTML = `<h3>Điểm danh thành công!</h3><p>Vị trí: ${lat}, ${lon}</p>`;
    }).catch(() => {
      document.body.innerHTML = "<h3>Có lỗi khi gửi dữ liệu!</h3>";
    });

  }, function() {
    alert("Không thể lấy vị trí. Vui lòng bật định vị!");
  });
});
</script>
</body>
</html>
